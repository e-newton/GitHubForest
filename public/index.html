<html>

<head>
  <title>Express</title>
  <link rel="stylesheet" href="/stylesheets/style.css">

</head>

<body>
<p id = "json"></p>
  <script src = "three.js"></script>
  <script src = "OrbitControls.js" type = module></script>

  <script type = 'module'>



    class User {
      constructor(calendar, years, currentYear) {
        this.calendar = calendar;
        this.years = years;
        this.weeks = calendar.weeks;
        this.days = [];
        this.currentYear = currentYear;
        this.weeks.forEach(week => {
          week["contributionDays"].forEach(day =>{
            this.days.push(day);
          })
        });

      }
    }

    let currentUser;
    const currentYear = new Date().getFullYear();
    const data = {user: "e-newton", year: currentYear}
    const options = {
      method: 'POST', // *GET, POST, PUT, DELETE, etc.
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data) // body data type must match "Content-Type" header
    };

    function getCurrentUserData() {
      fetch('/contributions', options).then(res => {
        return res.json();
      }).then(json => {
        const cc = json.data.user["contributionsCollection"];
        currentUser = new User(cc["contributionCalendar"], cc["contributionYears"]);
        console.log(currentUser);
        currentUser.years.forEach(year => {
        })

      });
    }

    getCurrentUserData();









    import * as THREE from '../build/three.module.js';
    import { OrbitControls } from '/OrbitControls.js';
    var smallTree;
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
    var loader = new THREE.ObjectLoader();
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.shadowMap.enabled = true;
    document.body.appendChild( renderer.domElement );

    loader.load("smallTree.json", function ( obj ) {
      console.log(obj)
      smallTree = obj;
    });

    var controls = new OrbitControls( camera, renderer.domElement );
    var directionalLight = new THREE.DirectionalLight( 0xffffff, 2 );
    directionalLight.position.set(5,25,7.5);
    directionalLight.castShadow = true;

    scene.add( directionalLight );
    var group = new THREE.Group();
    group.add(directionalLight);
    scene.add(group);
    camera.position.z = 5;

    controls.update();
    var done = false;
    function animate() {
      requestAnimationFrame( animate );
      if(smallTree !== undefined && !done){
        //scene.add(smallTree.clone());
        done = true;
        console.log("DONE")
        console.log(smallTree);

        for (let i = -2; i < 3; i++){
          for (let j = -2; j <3; j++){
            let pos = new THREE.Vector3(2*i,0,2*j);
            let t = createTree(pos)
            scene.add(t);
            console.log(t);
          }


        }
      } else if(!done){
        console.log("NOT DONE")
      }


      renderer.render( scene, camera );
    }
    animate();

    function createTree(position){
      let tree = smallTree.clone();
      tree.position.set(position.x, position.y, position.z);
      return tree;
    }




  </script>

</body>

</html>
